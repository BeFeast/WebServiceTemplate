# AGENTS.md - WebServiceTemplate

## Project Snapshot
- **Type**: Fullstack monorepo template (FastAPI + Next.js)
- **Stack**: Python 3.12 (uv), TypeScript (bun), Docker, PostgreSQL, Redis
- **Purpose**: GitHub template for DevBox-deployed web services
- **Sub-agents**: See `backend/AGENTS.md` and `frontend/AGENTS.md` for details

## Root Setup Commands
```bash
# Initialize project from template (replaces placeholders)
./scripts/init-project.sh

# Start development (docker-compose)
make dev

# Or run separately:
make dev-backend   # FastAPI at :8000
make dev-frontend  # Next.js at :3000

# Install dependencies locally
make install
```

## Universal Conventions

### Code Style
- **Python**: Ruff formatter + linter, type hints required
- **TypeScript**: ESLint + Prettier, strict mode enabled
- **Imports**: Absolute paths (`@/` for frontend, `app.` for backend)

### Commits
- Use conventional commits: `feat:`, `fix:`, `chore:`, `docs:`
- Include ticket/issue reference when applicable

### Placeholders
Template uses `{{PLACEHOLDER}}` syntax replaced by `init-project.sh`:
- `{{PROJECT_NAME}}`, `{{PROJECT_SUBDOMAIN}}`, `{{BACKEND_PORT}}`, `{{FRONTEND_PORT}}`
- `{{SECRET_KEY}}`, `{{DB_PASS}}`, `{{REDIS_DB_NUM}}`

## Security & Secrets
- **NEVER** commit `.env` files (only `.env.example`)
- Secrets go in `.env` at project root
- Database credentials auto-generated by `init-project.sh`
- Google OAuth credentials must be manually configured

## JIT Index

### Directory Structure
```
├── backend/           → [see backend/AGENTS.md](backend/AGENTS.md)
│   ├── app/api/       # FastAPI route handlers
│   ├── app/core/      # Config, security, database
│   ├── app/models/    # SQLAlchemy models
│   ├── app/schemas/   # Pydantic schemas
│   └── app/services/  # Business logic
├── frontend/          → [see frontend/AGENTS.md](frontend/AGENTS.md)
│   ├── src/app/       # Next.js App Router pages
│   ├── src/components/# React components
│   └── src/lib/       # Utilities, API client
├── docker/            # Docker Compose files
├── scripts/           # Automation (init, deploy, db)
└── .devcontainer/     # VS Code remote development
```

### Quick Find Commands
```bash
# Find FastAPI routes
rg -n "^@router\." backend/app/api/

# Find React components
rg -n "export (function|const)" frontend/src/components/

# Find SQLAlchemy models
rg -n "class.*Base\)" backend/app/models/

# Find Pydantic schemas
rg -n "class.*BaseModel" backend/app/schemas/

# Find environment usage
rg -n "settings\." backend/app/
rg -n "process\.env\." frontend/src/
```

## Infrastructure

### DevBox Deployment
- **Development**: `/opt/projects/<project>/`
- **Production stack**: `/opt/stacks/<project>/`
- **Database**: ok-shared-infra PostgreSQL (external, not in compose)
- **Cache**: ok-shared-infra Redis (external, not in compose)
- **Network**: `ok-shared-network` (external Docker network)

### Key Scripts
```bash
./scripts/init-project.sh      # Initialize from template
./scripts/create-project-db.sh # Create DB in shared PostgreSQL
./scripts/setup-subdomain.sh   # Configure NPM + Cloudflare
./scripts/deploy-to-devbox.sh  # Deploy via Portainer
```

## Definition of Done
Before PR:
```bash
make lint          # Ruff + ESLint pass
make test          # pytest + Playwright pass
make build         # Docker images build successfully
```
